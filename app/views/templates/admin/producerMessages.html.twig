{% extends "/admin/layoutProducer.html.twig" %}

{% block content %}
    <section id="producer-messages">

        {% if messages is not empty %}
            <div class="messages-list">
                <h1>Mes messages</h1>
                {% for msg in messages %}
                    <div class="message-card {% if msg.is_sender %}sent{% else %}received{% endif %}">
                        <div class="message-header">
                            <strong>
                                {% if msg.is_sender %}
                                    Vous avez écrit à {{ msg.receiverFirstName }} {{ msg.receiverLastName }}
                                {% else %}
                                    Vous avez reçu un message {{ msg.senderFirstName }} {{ msg.senderLastName }}
                                {% endif %}
                            </strong

                            {% if msg.productTitle %}
                                <span class="product-title">Produit : {{ msg.productTitle }}</span>
                            {% endif %}

                            <span class="date"> <strong>Le {{ msg.sentAt ? msg.sentAt|date("d/m/Y à H:i") : "" }}</strong> </span>
                        </div>

                        <div class="message-body">
                            <p>{{ msg.content|nl2br }}</p>
                        </div>

                        {% if msg.is_sender %}
                            <div class="message-actions">
                                <a href="/AgriMai/index.php?route=editMessageProducer&id={{ msg.id }}">Modifier</a>
                                <a href="/AgriMai/index.php?route=deleteMessage&id={{ msg.id }}"
                                   onclick="return confirm('Voulez-vous vraiment supprimer ce message ?');">
                                    Supprimer
                                </a>
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>Vous n'avez aucun message pour le moment.</p>
        {% endif %}

        {% if receiver_id %}
            <div class="reply-form">
                <h2>Envoyer un nouveau message</h2>
                <form method="post" action="/AgriMai/index.php?route=sendMessage"class="form-messageProducer">
                    <input type="hidden" name="receiver_id" value="{{ receiver_id }}">
                    <input type="hidden" name="product_id" value="{{ product_id }}">

                    <label for="name">Votre nom :</label>
                    <input type="text" id="name" name="name"
                           value="{{ session.user.first_name }} {{ session.user.last_name }}" required>

                    <label for="email">Votre email :</label>
                    <input type="email" id="email" name="email"
                           value="{{ session.user.email }}" required>

                    <label for="message">Votre message :</label>
                    <textarea id="message" name="message" placeholder="Écrire un message..." required></textarea>
                    <div class="reply-actions">
                        <button type="submit">Envoyer</button>
                    </div>
                </form>


            </div>
        {% else %}
            <p>Aucun destinataire disponible pour le moment.</p>
        {% endif %}
    </section>
{% endblock %}
